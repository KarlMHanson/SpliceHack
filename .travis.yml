language: c
matrix:
  include:
  - name: linux-xenial-gcc
    os: linux
    env: HINTS=linux LUA_VERSION=5.3.5
    compiler: gcc
    script:
    - cd sys/unix/ && sh setup.sh hints/$HINTS && cd ../../
    - make fetch-lua
    - test -d "lib/lua-$LUA_VERSION/src" || exit 0
    - make install
  - name: linux-bionic-gcc
    os: linux
    env: HINTS=linux LUA_VERSION=5.3.5
    dist: bionic
    compiler: gcc
    script:
    - cd sys/unix/ && sh setup.sh hints/$HINTS && cd ../../
    - make fetch-lua
    - test -d "lib/lua-$LUA_VERSION/src" || exit 0
    - make install
  - name: linux-xenial-clang
    os: linux
    env: HINTS=linux LUA_VERSION=5.3.5
    compiler: clang
    script:
    - cd sys/unix/ && sh setup.sh hints/$HINTS && cd ../../
    - make fetch-lua
    - test -d "lib/lua-$LUA_VERSION/src" || exit 0
    - make install
  - name: linux-xenial-gcc-x11
    os: linux
    env: HINTS=linux-x11 LUA_VERSION=5.3.5
    compiler: gcc
    addons:
      apt:
        packages:
        - libx11-dev
        - libxaw7-dev
        - xfonts-utils
    script:
    - cd sys/unix/ && sh setup.sh hints/$HINTS && cd ../../
    - make fetch-lua
    - test -d "lib/lua-$LUA_VERSION/src" || exit 0
    - make install
  - name: linux-bionic-gcc-x11
    os: linux
    env: HINTS=linux-x11 LUA_VERSION=5.3.5
    dist: bionic
    compiler: gcc
    addons:
      apt:
        packages:
        - libx11-dev
        - libxaw7-dev
        - xfonts-utils
    script:
    - cd sys/unix/ && sh setup.sh hints/$HINTS && cd ../../
    - make fetch-lua
    - test -d "lib/lua-$LUA_VERSION/src" || exit 0
    - make install
  - name: linux-xenial-gcc-minimal
    os: linux
    env: HINTS=linux-minimal LUA_VERSION=5.3.5
    compiler: gcc
    script: |
      cd sys/unix/ && sh setup.sh hints/$HINTS && cd ../../
      sed -i '/^#define CLIPPING/d'       include/config.h
      sed -i '/^#define COMPRESS/d'       include/config.h
      #sed -i '/^#define DOAGAIN/d'        include/config.h
      sed -i '/^#define DUMPLOG/d'        include/config.h
      #sed -i '/^#define GDBPATH/d'        include/config.h
      #sed -i '/^#define GREPPATH/d'       include/config.h
      sed -i '/^#define INSURANCE/d'      include/config.h
      sed -i '/^#define LOGFILE/d'        include/config.h
      sed -i '/^#define NEWS/d'           include/config.h
      sed -i '/^#define PANICLOG/d'       include/config.h
      #sed -i '/^#define STATUS_HILITES/d' include/config.h
      sed -i '/^#define SYSCF/d'          include/config.h
      sed -i '/^#define USER_SOUNDS/d'    include/config.h
      sed -i '/^#define XLOGFILE/d'       include/config.h

      sed -i '/^#define MAIL/d'           include/unixconf.h
      sed -i '/^#define SHELL/d'          include/unixconf.h
      sed -i '/^#define SUSPEND/d'        include/unixconf.h
      sed -i 's/^#define TEXTCOLOR//'     include/unixconf.h
      make fetch-lua
      test -d "lib/lua-$LUA_VERSION/src" || exit 0
      make install
      cat dat/options
  - name: windows-visualstudio
    os: windows
    language: shell
    script:
    - "./win/win32/vs2017/travisci.sh"
  - name: msdos crosscompile on linux
    os: linux
    env: HINTS=linux LUA_VERSION=5.3.5
    compiler: gcc
    script:
    - cd sys/unix/ && sh setup.sh hints/$HINTS && cd ../../
    - make fetch-lua
    - test -d "lib/lua-$LUA_VERSION/src" || exit 0
    - cd lib/lua-$LUA_VERSION/src && make a && cd ../../..
    - sh sys/msdos/msdos-cross-compile.sh
  exclude:
  - os: osx
    osx_image: xcode10.2
    env: HINTS=macosx10.14
    compiler: clang
    script: cd sys/unix/ && sh setup.sh hints/$HINTS && cd ../../ && make install
deploy:
  provider: releases
  api_key:
    secure: lscTQRvnlyuNRbEmj4sMF1uO0vltFF1J5rLiYmqlbuLq3YRj8+1wLoM0cWqU5x/ZsWLDBPwo1VerGlwIdZw/+85z3tx/Cw+Cv+fSFqKQJFFVMA0iUJu3elPvshSK0mObgH+vTwGi8LSmaefutqnUq/5mKb6ALPWr9ai7Q5RH8TVKBfXp+gynfe6NS/ldVkfX+IrqlcrVzDv2APqfVGM5SLXBeJQP8y9q8emml36l/dJZqRXMqEN7pPTZlrLc8yNY70yLT3pJLEtANcu7qCNQauUNNzAjb5Gqh1FNmBer2/fLrTY7gMmWE2PvEcd0fWaypByFBByHR0l+L6NGy/HOiAQCs1GHkNY/9H7R/D+a7YTqLO9dlBGmUbWhkCKkOv27mzju6CUTHtHhfDfHXoNtnTCOawFzsNC9JXba8Dwl4EOpWCGOyt3Zm5esg3OQOMiQoFY0nFpY/Uw1Pz3DaYflfp5nriO8jXSKnmHRxKhvVtW8m2Ano5A/FaXfDUdh8HMCi0TGD398G+s9bIyAHlUMfWF3Bv5QJbpW82/8y9Og40tIPfuCoUanGmNDPLfTArgTQnd9NXu9KeWDQgwMaq5rfVBKpyVVeojzRfllCqY7hUboGohRb/XhwUvK4evyd50iCLG9Lt+OxglRqagQh50HXV+y4RTCW00OS7zbj847CSo=
  file: spl-binaries.zip
  on:
    repo: NullCGT/SpliceHack
    branch: development
